---
title: "è¨ºæ–­ãƒ¡ãƒ¼ã‚«ãƒ¼ã‹ã‚‰è¨ºæ–­çµæœã‚’å–å¾—(Python, Bash)"
emoji: "ğŸ˜€"
type: "tech"
topics: [Python,Bash,curl,ã‚·ã‚§ãƒ«èŠ¸]
published: true
---
# ä½•ï¼Ÿ

[è¨ºæ–­ãƒ¡ãƒ¼ã‚«ãƒ¼](https://shindanmaker.com)ã‹ã‚‰çµæœã‚’å–å¾—ã—ãŸã„

## æ‰‹æ®µ

- è¦Session
- è¨ºæ–­ãƒšãƒ¼ã‚¸ã«ä»¥ä¸‹ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’POST:
  - `_token`: è¨ºæ–­ãƒšãƒ¼ã‚¸ã‹ã‚‰å–å¾—
  - `shindanName`: ä»»æ„
      - ã“ã“ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ã™ã‚‹ã¨ãƒ©ãƒ³ãƒ€ãƒ ãªçµæœãŒå¾—ã‚‰ã‚Œã¦æ¥½ã—ã„
  - `hiddenName`: è¨ºæ–­ãƒšãƒ¼ã‚¸ã‹ã‚‰å–å¾—


## Python

```python
#!/usr/bin/env python
import random
import time
from typing import Optional

from bs4 import BeautifulSoup as BS
import requests

def shindan(url: str = 'https://shindanmaker.com/1023289',
            name: Optional[str] = None) -> str:
    session = requests.session()
    s = session.get(url)
    if s.status_code != 200:
        raise FileNotFoundError(s.status_code)
    source = BS(s.text)
    params = {i['name']: i['value']
              for i in source.find_all('input')[1:4]}
    params['shindanName'] = (str(random.random())
                             if name is None else name)
    login = session.post(url, data=params)
    # é€£ç¶šã§å–å¾—ã™ã‚‹å ´åˆã¯Waitã‚’å…¥ã‚Œã‚‹
    # time.sleep(random.uniform(2, 5))
    return BS(login.text).find('span', id='shindanResult').text

shindan()
# 'ãã‚“ãªã«ã‚¯ãƒ¬ãƒ¡ãƒ³ã—ãŸã„ã‚“ãªã‚‰æ°¸é ã«ã‚¯ãƒ¬ãƒ¡ãƒ³ã ã‘ã•ã›ã¦ã‚„ã‚ã†ã‹'
```

## Bash

```bash
#!/usr/bin/env bash

shindan() {
    url="${1-https://shindanmaker.com/1036646}"
    [ "$(
        curl -LI "$url" -o /dev/null -w '%{http_code}' -s
      )" -ne 200 ] && {
        echo Error>&2 && return 0
    } 
    name="${2-$RANDOM}"
    source="$(curl -s -c cookie.txt "$url")"
    inputs="$(
        echo -e "$source" | tr \< \\n | grep input |
        sed -nr '
        s/value=""/value="'$name'"/
        s/^.* name="([^"]+)".* value="([^"]+)">$/\1=\2/g
        4,6p' | tr \\n \& | sed 's/.$//'
    )"
    curl -s -X POST -d "$inputs" -b cookie.txt "$url" |
    grep -oP '<span id="shindanResult" [^>]+>(.*?)(</span>){5}' |
    sed -r 's_<br />_'\\n'_g;s/<[^>]+>//g'
    # é€£ç¶šã§å–å¾—ã™ã‚‹å ´åˆã¯Waitã‚’å…¥ã‚Œã‚‹
    # sleep "$[RANDOM%4+2]"
    rm cookie.txt
}
shindan
# ã­ã“ã£ã¦ã€ã‚€ã—ã ã€‚
# 
# ğ™”ğ™Šğ™ğ™ƒğ™„ğ™‰ğ™Šğ™”ğ˜¼
```

