---
title: "ã‚ªãƒ©ã‚¤ãƒªãƒ¼æœ¬ã®{URL,æ›¸å½±,æ›¸å,å‹•ç‰©å}ä¸€è¦§ã‚’sedã¨grepã¨awkã§å‡¦ç†"
emoji: "ğŸ˜€"
type: "tech"
topics: [awk,sed,grep,ã‚·ã‚§ãƒ«èŠ¸,ã‚ªãƒ©ã‚¤ãƒªãƒ¼æœ¬]
published: true
---
## ã¯ã˜ã‚ã«

@gin_135ã•ã‚“ã®[è¨˜äº‹](https://harpyja.daemon.asia/posts/2017-01-07-oreilly_animals_list/)ã‚’è©¦ã—ãŸãŒå‹•ã‹ãªã‹ã£ãŸã®ã§ã‚„ã£ã¦ã¿ãŸã€‚

## HTMLãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

ã¾ãš[ã‚ªãƒ©ã‚¤ãƒªãƒ¼ã‚¢ãƒ‹ãƒãƒ«ä¸€è¦§](https://www.oreilly.com/animals.csp?x-o=0)ã‹ã‚‰ãƒšãƒ¼ã‚¸ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€‚

```bash
# ã©ã¡ã‚‰ã‚’å®Ÿè¡Œã—ã¦ã‚‚å®Ÿè¡Œæ™‚é–“ã¯ã‚ã¾ã‚Šå¤‰ã‚ã‚‰ãªã„ï¼Ÿ
curl -s 'https://www.oreilly.com/animals.csp?x-o='{0..1243..20} > source
# 0.12s user 0.08s system 1% cpu 17.777 total
curl -s 'https://www.oreilly.com/animals.csp?x-o=[0-1243:20]' > source
# 0.11s user 0.09s system 0% cpu 20.113 total
```

## HTML->ç©ºç™½åŒºåˆ‡ã‚Š

å…ƒè¨˜äº‹ã§ã¯å‹•ç‰©ã ã‘æŠ½å‡ºã—ã¦ã„ãŸãŒã€ãã‚Œã ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ç°¡å˜ã™ãã‚‹ã€‚

```bash
grep -oP '(?<="animal-name">)[^<]+' source
```

ã®ã§ã€ã“ã‚Œã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ã€`<URL>\n<æ›¸å½±>\n<æ›¸å>\n<å‹•ç‰©å>\n\n`ã«æ•´å½¢ã—ã¦åˆ—æŒ™ã—ãŸã„ã€‚

```txt:head-20
https://shop.oreilly.com/product/9780596155452.do
https://covers.oreilly.com/images/9780596155452/cat.gif
Mobile Design and Development
12-Wired Bird of Paradise

https://shop.oreilly.com/product/0636920024491.do
https://covers.oreilly.com/images/0636920024491/cat.gif
Windows PowerShell for Developers
3-Banded Armadillo

https://shop.oreilly.com/product/9780596007065.do
https://covers.oreilly.com/images/9780596007065/cat.gif
Jakarta Commons Cookbook
Aardvark

https://shop.oreilly.com/product/0636920029786.do
https://covers.oreilly.com/images/0636920029786/cat.gif
Clojure Cookbook
Aardwolf

```


æœ¬ã®æƒ…å ±ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«åˆ—æŒ™ã•ã‚Œã¦ã„ã‚‹ã€‚

```html
...
<div class="animal-row">
    <a class="book" href="https://shop.oreilly.com/product/9780596155452.do" title="">
      <img class="book-cvr" src="https://covers.oreilly.com/images/9780596155452/cat.gif" />
      <p class="book-title">Mobile Design and Development</p>
    </a>
    <p class="animal-name">12-Wired Bird of Paradise</p>
  </div>
<div class="animal-row">
...
```

ã‚ã¨ã¯æ°—åˆã€‚çµæœçš„ã«`grep`, `sed`ã‚’1å›ãšã¤ä½¿ã£ãŸã€‚

```bash
grep -oP '(?<="book" href=")[^"]+|(?<="book-cvr" src=")[^"]+|(?<="book-title">)[^<]+|(?<="animal-name">)[^<]+' source | sed '4~4G'
```

ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼ã ã¨è¦‹ã«ãã„ã®ã§æ”¹è¡Œã€‚

```bash
grep -oP '(?<="book" href=")[^"]+'\
'|(?<="book-cvr" src=")[^"]+'\
'|(?<="book-title">)[^<]+'\
'|(?<="animal-name">)[^<]+' source | sed '4~4G'
```

`grep`ã¯`-o`ã§ãƒãƒƒãƒéƒ¨åˆ†ã®ã¿ã‚’æŠ½å‡ºã•ã›ã‚‹ã€‚ã¾ãŸ`-P`ã§Perlæ­£è¦è¡¨ç¾ã‚’æœ‰åŠ¹åŒ–ã—ã€è‚¯å®šå…ˆèª­ã¿ã‚’ç”¨ã„ã¦å¿…è¦è¦ç´ ã®ãƒ†ã‚­ã‚¹ãƒˆéƒ¨ã®ã¿ãƒãƒƒãƒã•ã›ã¦ã„ã‚‹ã€‚

`sed`ã¯`4~4`ã§`NR%4==0`ã¨ãªã‚‹è¡Œã®æœ«å°¾ã«`G`ã‚³ãƒãƒ³ãƒ‰ã§ç©ºè¡Œã‚’æŒ¿å…¥ã—ã¦ã„ã‚‹ã€‚

## ç©ºè¡ŒåŒºåˆ‡ã‚Š->JSON

[briandfoy/oreilly-animals](https://github.com/briandfoy/oreilly-animals)ã‚’è¦‹ç¿’ã£ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãª[æ‰±ã„ã‚„ã™ã„JSONå½¢å¼](https://github.com/briandfoy/oreilly-animals/blob/master/animals.json)ã«å¤‰æ›ã—ãŸã„ã€‚

```json
[
  {
    "animal": "12-Wired Bird of Paradise",
    "cover_src": "https://covers.oreilly.com/images/9780596155452/cat.gif",
    "link": "https://shop.oreilly.com/product/9780596155452.do",
    "title": "Mobile Design and Development"
  },
  { ... }
]
````

ç©ºè¡ŒåŒºåˆ‡ã‚Šã®ãƒ‡ãƒ¼ã‚¿ã¯`awk`ã®`RS="";FS="\n"`ã§ã€é€šå¸¸é€šã‚Šå‡¦ç†ã§ãã‚‹ã€‚
ãŸã ã—ã€JSONãªã®ã§ã‚¯ã‚ªãƒ¼ãƒˆ`"`ã¯`\"`ã®ã‚ˆã†ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

```bash
grep -oP '(?<="book" href=")[^"]+'\
'|(?<="book-cvr" src=")[^"]+'\
'|(?<="book-title">)[^<]+'\
'|(?<="animal-name">)[^<]+' source | sed '4~4G' |
sed 's/"/\\"/g' |
awk 'BEGIN{RS="";FS="\n";printf"["}{printf"{\"animal\":\""$4"\",\"cover_src\":\""$2"\",\"link\":\""$1"\",\"title\":\""$3"\"},"}END{print"]"}' |
sed 's/..$/]/'
```

å‡ºåŠ›ã‚’`jq .`ã«æ¸¡ã™ã¨

```json:head-20
[
  {
    "animal": "12-Wired Bird of Paradise",
    "cover_src": "https://covers.oreilly.com/images/9780596155452/cat.gif",
    "link": "https://shop.oreilly.com/product/9780596155452.do",
    "title": "Mobile Design and Development"
  },
  {
    "animal": "3-Banded Armadillo",
    "cover_src": "https://covers.oreilly.com/images/0636920024491/cat.gif",
    "link": "https://shop.oreilly.com/product/0636920024491.do",
    "title": "Windows PowerShell for Developers"
  },
  {
    "animal": "Aardvark",
    "cover_src": "https://covers.oreilly.com/images/9780596007065/cat.gif",
    "link": "https://shop.oreilly.com/product/9780596007065.do",
    "title": "Jakarta Commons Cookbook"
  },
  {
```

ã‚ˆã•ãã†ã€‚

## ã•ã„ã”ã«

ã‚·ã‚§ãƒ«ã ã¨ã‚µã‚¯ã£ã¨çŸ­ã„è¨˜è¿°é‡ã§æ¸ˆã‚“ã§ã€æ¥½(å¯èª­æ€§ã¯â€¦)

